sap.ui.define(["jquery.sap.global","sap/ui/core/Control","google.maps","./TravelMode","./UnitSystem"],function(t,e,i,s,o){"use strict";var r=e.extend("openui5.googlemaps.Directions",{metadata:{properties:{startAddress:{type:"string",bindable:"bindable"},endAddress:{type:"string",bindable:"bindable"},travelMode:{type:"string",defaultValue:s.driving},optimizeWaypoints:{type:"boolean"},unitSystem:{type:"string",defaultValue:o.metric}},defaultAggregation:"waypoints",aggregations:{waypoints:{type:"openui5.googlemaps.Waypoint",multiple:true,bindable:"bindable"}},events:{response:{}},renderer:{}}});r.prototype.setStartAddress=function(t){this.setProperty("startAddress",t,true);this.route()};r.prototype.setEndAddress=function(t){this.setProperty("endAddress",t,true);this.route()};r.prototype.setTravelMode=function(t){this.setProperty("travelMode",t,true);this.route()};r.prototype.setOptimizeWaypoints=function(t){this.setProperty("optimizeWaypoints",t,true);this.route()};r.prototype.getWaypointLocations=function(){var t=[];this.getWaypoints().forEach(function(e){t.push({location:e.getLocation(),stopover:e.getStopover()})});return t};r.prototype._mapRendered=function(t){this.map=t;this.mapChanged()};r.prototype.responseChanged=function(){if(this.directions&&this.response){this.directions.setDirections(this.response)}};r.prototype.mapChanged=function(){if(!this.directions){this.directions=new i.DirectionsRenderer}this.directions.setMap(this.map);this.route()};r.prototype.getRequest=function(){var t={};t.origin=this.getStartAddress();t.destination=this.getEndAddress();t.travelMode=this.getTravelMode();t.unitSystem=this.getUnitSystem();t.optimizeWaypoints=this.getOptimizeWaypoints();t.waypoints=this.getWaypointLocations();return t};r.prototype.route=function(){if(!this.map||!this.getStartAddress()||!this.getEndAddress()){return}if(!this.directionsService){this.directionsService=new i.DirectionsService}t.sap.clearDelayedCall(this.delayedCallId);this.delayedCallId=t.sap.delayedCall(0,this,function(){this.directionsService.route(this.getRequest(),this.routeResponse.bind(this))})};r.prototype.routeResponse=function(e,s){if(s===i.DirectionsStatus.OK){t.sap.log.debug("Directions :: route response -"+e.toString(),this);this.response=e;this.responseChanged();this.fireResponse({response:e})}};r.prototype.reset=function(){if(this.directions){this.directions.setMap(null);this.directions=null}};r.prototype.exit=function(){this.reset()};return r},true);