sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/core/ResizeHandler","google.maps","./MapsApi","./MapUtils","./MapTypeId"],function(t,e,i,s,o,a,n){"use strict";var r=e.extend("openui5.googlemaps.Map",{metadata:{properties:{lat:{type:"float",bindable:"bindable",defaultValue:1},lng:{type:"float",bindable:"bindable",defaultValue:1},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"20em"},zoom:{type:"int",defaultValue:8},disableDefaultUI:{type:"boolean",defaultValue:true},mapTypeId:{type:"string",defaultValue:n.ROADMAP},panControl:{type:"boolean",defaultValue:false},zoomControl:{type:"boolean",defaultValue:false},zoomControlPosition:{type:"int",defaultValue:12},mapTypeControl:{type:"boolean",defaultValue:false},streetViewControl:{type:"boolean",defaultValue:false},fitToMarkers:{type:"boolean",defaultValue:false},mapsUrl:{type:"string",defaultValue:""},apiKey:{type:"string",defaultValue:""},clientId:{type:"string",defaultValue:""},version:{type:"string",defaultValue:"3.exp"},language:{type:"string",defaultValue:""},signedIn:{type:"boolean",defaultValue:false}},defaultAggregation:"markers",aggregations:{markers:{type:"openui5.googlemaps.Marker",multiple:true,bindable:"bindable"},polylines:{type:"openui5.googlemaps.Polyline",multiple:true,bindable:"bindable"},polygons:{type:"openui5.googlemaps.Polygon",multiple:true,bindable:"bindable"},directions:{type:"openui5.googlemaps.Directions",multiple:false,bindable:"bindable"},markerCluster:{type:"openui5.googlemaps.MarkerCluster",multiple:false,bindable:"bindable"}},events:{ready:{},click:{}}},renderer:function(t,e){t.write("<div ");t.writeControlData(e);t.addStyle("width","auto");t.addStyle("height","auto");t.writeClasses();t.writeStyles();t.write(">");t.renderControl(e._html);t.write("</div>")}});r.prototype.init=function(){this._dragging=false;this.aListeners=[];this.mapId=this.getId()+"-map";this._html=new sap.ui.core.HTML({content:"<div style='height: "+this.getHeight()+";width: "+this.getWidth()+";' id='"+this.mapId+"'></div>"})};r.prototype.onBeforeRendering=function(){if(s.loaded===undefined&&this._oMapsApi===undefined){this._oMapsApi=new o({mapsUrl:this.getMapsUrl(),apiKey:this.getApiKey(),clientId:this.getClientId(),version:this.getVersion(),language:this.getLanguage(),signedIn:this.getSignedIn()});this._oMapsApi.load()}};r.prototype.setHeight=function(t){this.setProperty("height",t,true);this.setSize();return this};r.prototype.setWidth=function(t){this.setProperty("width",t,true);this.setSize();return this};r.prototype.setSize=function(){if(!t.sap.domById(this.mapId)){var e=t(this._html.getContent());e.css("height",this.getHeight()).css("width",this.getWidth());this._html.setContent(e.outerHTML())}else{t.sap.byId(this.mapId).css("height",this.getHeight()).css("width",this.getWidth())}return this};r.prototype.setZoom=function(t){this.setProperty("zoom",t,true);if(this.map&&t!==this.map.getZoom()){this.map.setZoom(t)}return this};r.prototype.setLat=function(t){var e=parseFloat(t);if(!a.floatEqual(e,this.getLat())){this.setProperty("lat",e,true);this._updateCenter()}return this};r.prototype.setLng=function(t){var e=parseFloat(t);if(!a.floatEqual(e,this.getLng())){this.setProperty("lng",e,true);this._updateCenter()}return this};r.prototype.setFitToMarkers=function(t){this.setProperty("fitToMarkers",t,true);this._fitToMarkers();return this};r.prototype._updateCenter=function(){if(!this.map||this.getLat()===null||this.getLng()===null){return}t.sap.clearDelayedCall(this.delayedCallId);this.delayedCallId=t.sap.delayedCall(0,this,function(){this.map.setCenter(new s.LatLng(this.getLat(),this.getLng()));this.notifyAggregations("mapRendered")})};r.prototype.setMapTypeId=function(t){this.setProperty("mapTypeId",t,true);if(this.map&&t!==this.map.getMapTypeId()){this.map.setMapTypeId(t)}return this};r.prototype.setZoomControl=function(t){this.setProperty("zoomControl",t,true);if(this.map&&t!==this.map.zoomControl){this.map.zoomControl=t}return this};r.prototype.setZoomControlPosition=function(t){this.setProperty("zoomControlPosition",t,true);if(this.map&&t!==this.map.zoomControlOptions.position){this.map.zoomControlOptions={position:t}}return this};r.prototype.setDisableDefaultUI=function(t){this.setProperty("disableDefaultUI",t,true);if(this.map){this.map.setOptions({disableDefaultUI:this.getDisableDefaultUI()})}return this};r.prototype.zoomChanged=function(){if(this.map.getZoom()!==this.getZoom()){this.setZoom(this.map.getZoom())}};r.prototype.mapTypeIdChanged=function(){if(this.map.getMapTypeId()!==this.getMapTypeId()){this.setMapTypeId(this.map.getMapTypeId())}};r.prototype.onResize=function(){var t=this.map.getCenter();this.trigger("resize");this.map.setCenter(t)};r.prototype._getMapOptions=function(){var t={};t.zoom=this.getZoom();t.center=new s.LatLng(this.getLat(),this.getLng());t.disableDefaultUI=this.getDisableDefaultUI();t.mapTypeId=this.getMapTypeId();t.panControl=this.getPanControl();t.zoomControl=this.getZoomControl();t.zoomControlOptions={position:this.getZoomControlPosition()};t.mapTypeControl=this.getMapTypeControl();t.streetViewControl=this.getStreetViewControl();return t};r.prototype.notifyAggregations=function(t){var e=this.getMetadata().getAggregations();var i=Object.keys(e).map(function(t){return e[t]});var s=this.map;var o=function(e){e["_"+t](s)};i.forEach(function(t){var e=this[t._sGetter]();if(e){if(t.multiple===true){e.forEach(o)}else{o(e)}}}.bind(this))};r.prototype.onAfterRendering=function(){if(!s.loaded){if(this.subscribed===undefined){sap.ui.getCore().getEventBus().subscribe(s.notifyEvent,this.createMap,this);this.subscribed=true}return}if(!this.initialized){this.createMap()}else{this._updateCenter()}};r.prototype.createMap=function(){if(!this.getLat()||!this.getLng()){return}this.map=new s.Map(t.sap.domById(this.mapId),this._getMapOptions());this.notifyAggregations("mapRendered");this.addListener("drag",this.isDragging.bind(this));this.addListener("dragstart",this.isDragging.bind(this));this.addListener("zoom_changed",this.zoomChanged.bind(this));this.addListener("idle",this.mapChanged.bind(this));this.addListener("maptypeid_changed",this.mapTypeIdChanged.bind(this));this.addListener("click",this.clicked.bind(this));this.resizeID=i.register(t.sap.domById(this.mapId),this.onResize.bind(this));this._fitToMarkers();this.initialized=true};r.prototype.addListener=function(t,e){this.aListeners.push(a.addListener(this.map,t,e))};r.prototype.removeListeners=function(){this.aListeners.forEach(function(t){t.remove()});this.aListeners=[]};r.prototype.trigger=function(t,e){s.event.trigger(this.map,t,e)};r.prototype.isDragging=function(){this._dragging=true};r.prototype.isNotDragging=function(){this._dragging=false};r.prototype.mapChanged=function(){if(this._dragging){this.isNotDragging()}this.fireReady({map:this.map,context:this.getBindingContext(),lat:this.getLat(),lng:this.getLng()})};r.prototype._fitToMarkers=function(){if(this.map&&this.getFitToMarkers()&&this.getMarkers().length>0){var t=new s.LatLngBounds;this.getMarkers().forEach(function(e){t.extend(e.marker.getPosition())});if(this.getMarkers().length>1){this.map.fitBounds(t)}}};r.prototype.resetMap=function(){this.removeListeners();if(this.map){this.map.set(null)}};r.prototype.exit=function(){this.resetMap();i.deregister(this.resizeID)};r.prototype.clicked=function(t){this.fireClick({map:this.map,context:this.getBindingContext(),lat:t.latLng.lat(),lng:t.latLng.lng()})};r.prototype.fitToSelectedMarkers=function(t){if(this.map&&t.length>0){var e=new s.LatLngBounds;t.forEach(function(t){e.extend(t.marker.getPosition())});if(this.getMarkers().length>1){this.map.fitBounds(e)}}};return r},true);